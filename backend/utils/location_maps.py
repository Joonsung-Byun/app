# location_maps.py

from typing import Optional, Dict, List

# ---------------------
# 1) 시 → (광역/도, 시군구)
# ---------------------
CITY_TO_PROVINCE_SIGNGU = {
    "서울": ("서울특별시",),
    "부산": ("부산광역시",),
    "대구": ("대구광역시",),
    "인천": ("인천광역시",),
    "광주": ("광주광역시",),
    "대전": ("대전광역시",),
    "울산": ("울산광역시",),
    "세종": ("세종특별자치시,"),
    "제주": ("제주특별자치도,"),

    "수원": ("경기도", "수원시"),
    "성남": ("경기도", "성남시"),
    "용인": ("경기도", "용인시"),
    "고양": ("경기도", "고양시"),
    "안양": ("경기도", "안양시"),
    "수원": ("경기도", "수원시"),
    "성남": ("경기도", "성남시"),
    "의정부": ("경기도", "의정부시"),
    "안양": ("경기도", "안양시"),
    "부천": ("경기도", "부천시"),
    "광명": ("경기도", "광명시"),
    "평택": ("경기도", "평택시"),
    "동두천": ("경기도", "동두천시"),
    "안산": ("경기도", "안산시"),
    "고양": ("경기도", "고양시"),
    "과천": ("경기도", "과천시"),
    "구리": ("경기도", "구리시"),
    "남양주": ("경기도", "남양주시"),
    "오산": ("경기도", "오산시"),
    "시흥": ("경기도", "시흥시"),
    "군포": ("경기도", "군포시"),
    "의왕": ("경기도", "의왕시"),
    "하남": ("경기도", "하남시"),
    "용인": ("경기도", "용인시"),
    "파주": ("경기도", "파주시"),
    "이천": ("경기도", "이천시"),
    "안성": ("경기도", "안성시"),
    "김포": ("경기도", "김포시"),
    "화성": ("경기도", "화성시"),
    "광주": ("경기도", "광주시"),
    "양주": ("경기도", "양주시"),
    "포천": ("경기도", "포천시"),
    "여주": ("경기도", "여주시"),

    # --- 강원도 ---
    "춘천": ("강원도", "춘천시"),
    "원주": ("강원도", "원주시"),
    "강릉": ("강원도", "강릉시"),
    "동해": ("강원도", "동해시"),
    "속초": ("강원도", "속초시"),
    "삼척": ("강원도", "삼척시"),
    "태백": ("강원도", "태백시"),

    # --- 충청북도 ---
    "청주": ("충청북도", "청주시"),
    "충주": ("충청북도", "충주시"),
    "제천": ("충청북도", "제천시"),

    # --- 충청남도 ---
    "천안": ("충청남도", "천안시"),
    "공주": ("충청남도", "공주시"),
    "보령": ("충청남도", "보령시"),
    "아산": ("충청남도", "아산시"),
    "서산": ("충청남도", "서산시"),
    "논산": ("충청남도", "논산시"),
    "계룡": ("충청남도", "계룡시"),
    "당진": ("충청남도", "당진시"),

    # --- 전라북도 ---
    "전주": ("전라북도", "전주시"),
    "익산": ("전라북도", "익산시"),
    "군산": ("전라북도", "군산시"),
    "정읍": ("전라북도", "정읍시"),
    "남원": ("전라북도", "남원시"),
    "김제": ("전라북도", "김제시"),

    # --- 전라남도 ---
    "목포": ("전라남도", "목포시"),
    "여수": ("전라남도", "여수시"),
    "순천": ("전라남도", "순천시"),
    "나주": ("전라남도", "나주시"),
    "광양": ("전라남도", "광양시"),

    # --- 경상북도 ---
    "포항": ("경상북도", "포항시"),
    "경주": ("경상북도", "경주시"),
    "김천": ("경상북도", "김천시"),
    "안동": ("경상북도", "안동시"),
    "구미": ("경상북도", "구미시"),
    "영주": ("경상북도", "영주시"),
    "영천": ("경상북도", "영천시"),
    "상주": ("경상북도", "상주시"),
    "문경": ("경상북도", "문경시"),
    "경산": ("경상북도", "경산시"),

    # --- 경상남도 ---
    "창원": ("경상남도", "창원시"),
    "진주": ("경상남도", "진주시"),
    "통영": ("경상남도", "통영시"),
    "사천": ("경상남도", "사천시"),
    "김해": ("경상남도", "김해시"),
    "밀양": ("경상남도", "밀양시"),
    "거제": ("경상남도", "거제시"),
    "양산": ("경상남도", "양산시")

}

# ---------------------
# 2) extract_location이 참조할 정보들
#    실제 서비스에서는 각 맵에 상세 데이터를 채워서 사용합니다.
#    현재는 기본 동작을 위해 빈 dict로 초기화합니다.
# ---------------------
KMA_LOCATION_CODES: Dict[str, str] = {}
DONG_TO_CITY: Dict[str, str] = {}
LANDMARK_TO_CITY: Dict[str, str] = {}
UNIVERSITY_TO_CITY: Dict[str, str] = {}
LOCATION_MAP: Dict[str, List[str]] = {}

# ---------------------
# 3) extract_location 함수
# ---------------------
def extract_location(text: str) -> Optional[str]:
    text = text.strip().replace(" ", "")

    # 1) KMA 지역코드 기반 시/군/구 매칭
    for city in KMA_LOCATION_CODES.keys():
        if city in text:
            return city

    # 2) 동(洞) 단위 매핑
    for dong, city in DONG_TO_CITY.items():
        if dong in text:
            return city

    # 3) 명소 매핑
    for landmark, city in LANDMARK_TO_CITY.items():
        if landmark in text:
            return city

    # 4) 대학 매핑
    for univ, city in UNIVERSITY_TO_CITY.items():
        if univ in text:
            return city

    # 5) LOCATION_MAP 기반 매칭
    for city, names in LOCATION_MAP.items():
        for name in names:
            if name in text:
                return city

    # 6) 보정용 키워드
    keyword_city_map = {
        "한강": "서울",
        "청계천": "서울",
        "광안리": "부산",
        "해운대": "부산",
        "에버랜드": "용인",
        "한라산": "제주",
    }
    for kw, city in keyword_city_map.items():
        if kw in text:
            return city

    return None
